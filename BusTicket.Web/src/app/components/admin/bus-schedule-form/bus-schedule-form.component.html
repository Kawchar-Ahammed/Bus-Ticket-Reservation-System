<div class="form-container">
  <div class="form-header">
    <div class="header-content">
      <div class="header-icon">
        <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
          <line x1="16" y1="2" x2="16" y2="6"></line>
          <line x1="8" y1="2" x2="8" y2="6"></line>
          <line x1="3" y1="10" x2="21" y2="10"></line>
        </svg>
      </div>
      <div>
        <h1>{{ isEditMode ? 'Edit Schedule' : 'Create New Schedule' }}</h1>
        <p>{{ isEditMode ? 'Update bus schedule details' : 'Add a new bus journey schedule' }}</p>
      </div>
    </div>
    <button class="btn-back" routerLink="/admin/schedules">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <line x1="19" y1="12" x2="5" y2="12"></line>
        <polyline points="12 19 5 12 12 5"></polyline>
      </svg>
      Back to Schedules
    </button>
  </div>

  <div class="form-card">
    <form [formGroup]="scheduleForm" (ngSubmit)="onSubmit()">
      <div class="alert alert-error" *ngIf="errorMessage">
        {{ errorMessage }}
      </div>

      <div class="form-section">
        <h3>Bus & Route Selection</h3>
        
        <div class="form-row">
          <div class="form-group">
            <label for="busId">Bus *</label>
            <select id="busId" formControlName="busId" [class.disabled]="isEditMode">
              <option value="">Select a bus</option>
              <option *ngFor="let bus of buses" [value]="bus.id">
                {{ bus.busNumber }} - {{ bus.busName }} ({{ bus.companyName }})
              </option>
            </select>
            <small *ngIf="isEditMode" class="help-text">
              Bus cannot be changed
            </small>
            <small *ngIf="loadingBuses && !isEditMode" class="help-text">Loading buses...</small>
            <small *ngIf="!loadingBuses && buses.length === 0 && !isEditMode" class="warning-text">
              No active buses found. Please create a bus first.
            </small>
            <span class="error-message" *ngIf="getFieldError('busId')">
              {{ getFieldError('busId') }}
            </span>
          </div>

          <div class="form-group">
            <label for="routeId">Route *</label>
            <select id="routeId" formControlName="routeId" (change)="onRouteChange($any($event.target).value)" [class.disabled]="isEditMode">
              <option value="">Select a route</option>
              <option *ngFor="let route of routes" [value]="route.id">
                {{ route.fromCity }} â†’ {{ route.toCity }}
              </option>
            </select>
            <small *ngIf="isEditMode" class="help-text">
              Route cannot be changed
            </small>
            <small *ngIf="loadingRoutes && !isEditMode" class="help-text">Loading routes...</small>
            <small *ngIf="!loadingRoutes && routes.length === 0 && !isEditMode" class="warning-text">
              No active routes found. Please create a route first.
            </small>
            <span class="error-message" *ngIf="getFieldError('routeId')">
              {{ getFieldError('routeId') }}
            </span>
          </div>
        </div>
      </div>

      <div class="form-section">
        <h3>Journey Details</h3>
        
        <div class="form-group">
          <label for="journeyDate">Journey Date *</label>
          <input
            id="journeyDate"
            type="date"
            formControlName="journeyDate"
            [min]="getCurrentDate()"
          />
          <span class="error-message" *ngIf="getFieldError('journeyDate')">
            {{ getFieldError('journeyDate') }}
          </span>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>Departure Time *</label>
            <div class="time-inputs">
              <div class="time-input-group">
                <input
                  type="number"
                  formControlName="departureHour"
                  placeholder="HH"
                  min="0"
                  max="23"
                />
                <span class="time-separator">:</span>
                <input
                  type="number"
                  formControlName="departureMinute"
                  placeholder="MM"
                  min="0"
                  max="59"
                />
              </div>
            </div>
            <span class="error-message" *ngIf="getFieldError('departureHour') || getFieldError('departureMinute')">
              {{ getFieldError('departureHour') || getFieldError('departureMinute') }}
            </span>
          </div>

          <div class="form-group">
            <label>Arrival Time *</label>
            <div class="time-inputs">
              <div class="time-input-group">
                <input
                  type="number"
                  formControlName="arrivalHour"
                  placeholder="HH"
                  min="0"
                  max="23"
                />
                <span class="time-separator">:</span>
                <input
                  type="number"
                  formControlName="arrivalMinute"
                  placeholder="MM"
                  min="0"
                  max="59"
                />
              </div>
            </div>
            <span class="error-message" *ngIf="getFieldError('arrivalHour') || getFieldError('arrivalMinute')">
              {{ getFieldError('arrivalHour') || getFieldError('arrivalMinute') }}
            </span>
          </div>
        </div>
      </div>

      <div class="form-section">
        <h3>Fare & Locations</h3>
        
        <div class="form-row">
          <div class="form-group">
            <label for="fareAmount">Fare Amount *</label>
            <input
              id="fareAmount"
              type="number"
              formControlName="fareAmount"
              placeholder="e.g., 500"
              min="1"
              step="0.01"
            />
            <span class="error-message" *ngIf="getFieldError('fareAmount')">
              {{ getFieldError('fareAmount') }}
            </span>
          </div>

          <div class="form-group">
            <label for="fareCurrency">Currency *</label>
            <input
              id="fareCurrency"
              type="text"
              formControlName="fareCurrency"
              placeholder="BDT"
              maxlength="3"
            />
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="boardingCity">Boarding City *</label>
            <input
              id="boardingCity"
              type="text"
              formControlName="boardingCity"
              placeholder="e.g., Dhaka"
            />
            <span class="error-message" *ngIf="getFieldError('boardingCity')">
              {{ getFieldError('boardingCity') }}
            </span>
          </div>

          <div class="form-group">
            <label for="droppingCity">Dropping City *</label>
            <input
              id="droppingCity"
              type="text"
              formControlName="droppingCity"
              placeholder="e.g., Chittagong"
            />
            <span class="error-message" *ngIf="getFieldError('droppingCity')">
              {{ getFieldError('droppingCity') }}
            </span>
          </div>
        </div>
      </div>

      <div class="form-section" *ngIf="isEditMode">
        <h3>Status</h3>
        
        <div class="form-group">
          <label class="checkbox-label">
            <input type="checkbox" formControlName="isActive" />
            <span>Active</span>
          </label>
          <small class="help-text">
            Inactive schedules won't be available for booking
          </small>
        </div>
      </div>

      <div class="form-actions">
        <button type="button" class="btn-secondary" routerLink="/admin/schedules">
          Cancel
        </button>
        <button 
          type="submit" 
          class="btn-primary" 
          [disabled]="isLoading || loadingBuses || loadingRoutes || (buses.length === 0 && !isEditMode) || (routes.length === 0 && !isEditMode)">
          {{ isLoading ? 'Saving...' : (isEditMode ? 'Update Schedule' : 'Create Schedule') }}
        </button>
      </div>
    </form>
  </div>
</div>
