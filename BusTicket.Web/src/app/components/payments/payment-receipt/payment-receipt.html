<div class="receipt-container" *ngIf="payment">
  <!-- Print Header (visible only on print) -->
  <div class="print-header">
    <h2 class="text-center mb-0">Bus Ticket Reservation System</h2>
    <p class="text-center text-muted">Payment Receipt</p>
  </div>

  <!-- Receipt Card -->
  <div class="card receipt-card">
    <div class="card-header bg-success text-white">
      <div class="d-flex justify-content-between align-items-center">
        <h5 class="mb-0">
          <i class="bi bi-receipt me-2"></i>
          Payment Receipt
        </h5>
        <span class="badge bg-light text-success">
          {{ getStatusName(payment.status) }}
        </span>
      </div>
    </div>

    <div class="card-body">
      <!-- Success Icon -->
      <div class="text-center mb-4">
        <div class="success-icon">
          <i class="bi bi-check-circle-fill text-success"></i>
        </div>
        <h4 class="text-success mt-3">Payment Successful!</h4>
        <p class="text-muted">Thank you for your payment. Your booking is confirmed.</p>
      </div>

      <!-- Transaction Details -->
      <div class="receipt-section">
        <h6 class="section-title">Transaction Details</h6>
        <div class="row g-3">
          <div class="col-md-6">
            <div class="detail-item">
              <span class="detail-label">Transaction ID</span>
              <span class="detail-value">{{ payment.transactionId }}</span>
            </div>
          </div>
          <div class="col-md-6">
            <div class="detail-item">
              <span class="detail-label">Gateway Transaction ID</span>
              <span class="detail-value">{{ payment.gatewayTransactionId || 'N/A' }}</span>
            </div>
          </div>
          <div class="col-md-6">
            <div class="detail-item">
              <span class="detail-label">Payment Date</span>
              <span class="detail-value">{{ payment.paymentDate | date: 'medium' }}</span>
            </div>
          </div>
          <div class="col-md-6">
            <div class="detail-item">
              <span class="detail-label">Payment Method</span>
              <span class="detail-value">{{ payment.paymentMethodName }}</span>
            </div>
          </div>
          <div class="col-md-6">
            <div class="detail-item">
              <span class="detail-label">Payment Gateway</span>
              <span class="detail-value">{{ payment.gatewayName }}</span>
            </div>
          </div>
          <div class="col-md-6">
            <div class="detail-item">
              <span class="detail-label">Status</span>
              <span class="badge bg-success">{{ getStatusName(payment.status) }}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Amount Details -->
      <div class="receipt-section">
        <h6 class="section-title">Payment Summary</h6>
        <div class="amount-details">
          <div class="d-flex justify-content-between mb-2">
            <span>Ticket Amount:</span>
            <span>{{ payment.currency }} {{ payment.amount | number: '1.2-2' }}</span>
          </div>
          <div class="d-flex justify-content-between mb-2" *ngIf="payment.refundAmount > 0">
            <span class="text-danger">Refund Amount:</span>
            <span class="text-danger">-{{ payment.currency }} {{ payment.refundAmount | number: '1.2-2' }}</span>
          </div>
          <hr>
          <div class="d-flex justify-content-between fw-bold">
            <span>Total Paid:</span>
            <span class="text-success h5 mb-0">
              {{ payment.currency }} {{ (payment.amount - (payment.refundAmount || 0)) | number: '1.2-2' }}
            </span>
          </div>
        </div>
      </div>

      <!-- Ticket Details (if available) -->
      <div class="receipt-section" *ngIf="ticketDetails">
        <h6 class="section-title">Ticket Details</h6>
        <div class="row g-3">
          <div class="col-md-6">
            <div class="detail-item">
              <span class="detail-label">Ticket ID</span>
              <span class="detail-value">{{ ticketDetails.id }}</span>
            </div>
          </div>
          <div class="col-md-6">
            <div class="detail-item">
              <span class="detail-label">Passenger Name</span>
              <span class="detail-value">{{ ticketDetails.passengerName }}</span>
            </div>
          </div>
          <div class="col-md-6">
            <div class="detail-item">
              <span class="detail-label">Route</span>
              <span class="detail-value">{{ ticketDetails.route }}</span>
            </div>
          </div>
          <div class="col-md-6">
            <div class="detail-item">
              <span class="detail-label">Seat Number</span>
              <span class="detail-value">{{ ticketDetails.seatNumber }}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Refund Information (if applicable) -->
      <div class="receipt-section" *ngIf="payment.refundAmount > 0">
        <h6 class="section-title text-danger">Refund Information</h6>
        <div class="row g-3">
          <div class="col-md-6">
            <div class="detail-item">
              <span class="detail-label">Refund Amount</span>
              <span class="detail-value text-danger">
                {{ payment.currency }} {{ payment.refundAmount | number: '1.2-2' }}
              </span>
            </div>
          </div>
          <div class="col-md-6">
            <div class="detail-item">
              <span class="detail-label">Refund Date</span>
              <span class="detail-value">{{ payment.refundDate | date: 'medium' }}</span>
            </div>
          </div>
          <div class="col-12">
            <div class="detail-item">
              <span class="detail-label">Refund Reason</span>
              <span class="detail-value">{{ payment.refundReason }}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Transaction History -->
      <div class="receipt-section" *ngIf="payment.transactions && payment.transactions.length > 0">
        <h6 class="section-title">Transaction History</h6>
        <div class="table-responsive">
          <table class="table table-sm">
            <thead>
              <tr>
                <th>Date & Time</th>
                <th>Action</th>
                <th>Status</th>
                <th>Amount</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let transaction of payment.transactions">
                <td>{{ transaction.processedAt | date: 'short' }}</td>
                <td>{{ transaction.action }}</td>
                <td>
                  <span class="badge" [ngClass]="{
                    'bg-success': transaction.isSuccess,
                    'bg-danger': !transaction.isSuccess
                  }">
                    {{ transaction.isSuccess ? 'Success' : 'Failed' }}
                  </span>
                </td>
                <td>{{ payment.currency }} {{ transaction.amount | number: '1.2-2' }}</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Footer Note -->
      <div class="receipt-footer mt-4">
        <p class="text-center text-muted small mb-2">
          This is a computer-generated receipt and does not require a signature.
        </p>
        <p class="text-center text-muted small mb-0">
          For any queries, please contact our support team with your transaction ID.
        </p>
      </div>

      <!-- Action Buttons (hide on print) -->
      <div class="no-print mt-4">
        <div class="d-flex gap-2 justify-content-center">
          <button class="btn btn-primary" (click)="printReceipt()">
            <i class="bi bi-printer me-2"></i>
            Print Receipt
          </button>
          <button class="btn btn-outline-primary" (click)="downloadReceipt()">
            <i class="bi bi-download me-2"></i>
            Download PDF
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
